<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psych Ai Mental Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@400;700&family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f0f9ff; /* sky-50 */
        }
        .font-mitr {
            font-family: 'Mitr', sans-serif;
        }
        .card {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .hidden-card {
            opacity: 0;
            transform: scale(0.95);
            position: absolute;
            width: 100%;
            left: 0;
            top: 0;
            pointer-events: none;
        }
        .visible-card {
            opacity: 1;
            transform: scale(1);
            position: static;
            pointer-events: auto;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .chat-bubble-user {
            background-color: #38bdf8; /* sky-400 */
            color: white;
            border-radius: 1.5rem 1.5rem 0.5rem 1.5rem;
        }
        .chat-bubble-ai {
            background-color: #ffffff; 
            color: #334155; /* slate-700 */
            border-radius: 1.5rem 1.5rem 1.5rem 0.5rem;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .chat-bubble-ai.thinking .dot {
            width: 8px; height: 8px; margin: 0 2px;
            background-color: #94a3b8; /* slate-400 */
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .chat-bubble-ai.thinking .dot:nth-child(1) { animation-delay: -0.32s; }
        .chat-bubble-ai.thinking .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        #printable-content { display: none; }
        @media print {
            body > *:not(#printable-content) { display: none !important; }
            #printable-content { display: block !important; }
        }
        .disabled-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.7);
            z-index: 20; backdrop-filter: blur(4px);
        }
        #cookie-consent-banner { transition: opacity 0.5s, visibility 0.5s; }
    </style>
</head>
<body class="text-slate-800">

    <div id="printable-content" class="p-8 bg-white"></div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl no-print">
        <div id="main-container" class="bg-white rounded-3xl shadow-lg p-6 sm:p-8 relative min-h-[600px] overflow-hidden flex flex-col justify-center">

            <!-- Landing View -->
            <div id="landingView" class="card visible-card">
                <div class="text-center">
                     <h1 class="text-5xl font-bold text-sky-600 font-mitr">Psych Ai Mental Assessment</h1>
                     <div class="mt-4 text-center text-sm text-slate-500 space-y-1">
                        <p>แอปพลิเคชันชิ้นนี้จัดทำขึ้นเพื่อประกวดโครงงาน เท่ได้ต้องไม่บูลลี่</p>
                        <p>โครงการ “เท่อย่างไทย โดย ไฟ-ฟ้า ทีทีบี”</p>
                    </div>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8">
                    <button id="goto-chat-btn" class="text-center p-8 bg-sky-50 rounded-2xl hover:bg-sky-100 hover:shadow-lg transition-all transform hover:-translate-y-1">
                        <h2 class="text-2xl font-bold text-sky-700 font-mitr">คุยกับพี่ทราย</h2>
                        <p class="mt-2 text-slate-600">พื้นที่ปลอดภัยสำหรับรับฟังและให้คำปรึกษาเบื้องต้น</p>
                    </button>
                    <button id="goto-assessments-btn" class="text-center p-8 bg-teal-50 rounded-2xl hover:bg-teal-100 hover:shadow-lg transition-all transform hover:-translate-y-1">
                        <h2 class="text-2xl font-bold text-teal-700 font-mitr">ทำแบบประเมิน</h2>
                        <p class="mt-2 text-slate-600">คัดกรองสุขภาพจิตเบื้องต้นด้วยแบบประเมินมาตรฐาน</p>
                    </button>
                </div>
                <div class="mt-12 text-center text-xs text-slate-400 space-y-1">
                    <p>พัฒนาโดย RPG15 Next Gen Youth Teams</p>
                    <p>โรงเรียนราชประชานุเคราะห์15 (เวียงเก่าแสนภูวิทยาประสาท)</p>
                </div>
            </div>

            <!-- Assessment List View -->
            <div id="assessmentListView" class="card hidden-card">
                 <button class="back-to-landing-btn absolute top-6 left-6 text-slate-500 hover:text-slate-800 z-10">&larr; กลับ</button>
                 <h2 class="text-3xl text-center font-bold text-slate-800 font-mitr">เลือกแบบประเมิน</h2>
                 <div class="mt-8 space-y-4">
                    <!-- Assessment cards will be generated by JS -->
                 </div>
            </div>

            <!-- Chat View -->
            <div id="chatView" class="card hidden-card">
                <button class="back-to-landing-btn absolute top-6 left-6 text-slate-500 hover:text-slate-800 z-10">&larr; กลับ</button>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-slate-800 font-mitr">คุยกับทราย</h2>
                    <button id="print-chat-btn" class="text-sm bg-slate-200 text-slate-700 font-semibold py-1 px-3 rounded-lg hover:bg-slate-300 transition-colors">พิมพ์บทสนทนา</button>
                </div>
                <div class="flex flex-col h-[70vh] bg-slate-50 border border-slate-200 rounded-2xl overflow-hidden">
                    <div id="chat-messages" class="flex-grow overflow-y-auto p-4 space-y-4"></div>
                    <div class="p-3 border-t border-slate-200 flex items-center bg-white">
                        <input type="text" id="chat-input" class="flex-grow p-3 border border-slate-300 rounded-l-xl focus:outline-none focus:ring-2 focus:ring-sky-500" placeholder="พิมพ์ข้อความ...">
                        <button id="chat-send-btn" class="bg-sky-500 text-white p-3 rounded-r-xl hover:bg-sky-600 transition-colors shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Assessment View -->
            <div id="assessmentView" class="card hidden-card"></div>
            <!-- Loading Spinner -->
            <div id="loading" class="card hidden-card flex justify-center items-center"></div>
            <!-- Results View -->
            <div id="results" class="card hidden-card"></div>
        </div>
        <footer class="text-center text-sm text-slate-500 mt-8 no-print space-x-4">
            <span>จัดทำโดย RPG15 Next Gen Youth</span>
            <button id="show-policy-btn" class="underline hover:text-sky-600">นโยบายความเป็นส่วนตัวและข้อกำหนดการใช้งาน</button>
        </footer>
    </div>

    <!-- Modals & Banners -->
    <div id="policyModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 no-print hidden"></div>
    <button id="emergency-btn" class="fixed bottom-24 right-6 bg-rose-500 text-white rounded-full p-4 shadow-lg z-40 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 transition-transform transform hover:scale-110 no-print">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
    </button>
    <div id="emergencyModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 no-print"></div>
    <div id="cookie-consent-banner" class="fixed bottom-0 left-0 right-0 bg-slate-800 text-white p-4 flex flex-col sm:flex-row items-center justify-between z-50 hidden no-print"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- CONFIGURATION ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzfdIFywfaDGgTljKEXFJjbS83SLAhx_2brWWuaWAOg597TRY2_Awi9WMO9o0jd3eNnjA/exec';
        const API_KEY = "AIzaSyCZW3olN0nCHSeOBLWRG9rEU9tKttfBaP8";

        // --- DOM ELEMENTS ---
        const mainContainer = document.getElementById('main-container');
        const landingView = document.getElementById('landingView');
        const assessmentListView = document.getElementById('assessmentListView');
        const chatView = document.getElementById('chatView');
        const assessmentView = document.getElementById('assessmentView');
        const loading = document.getElementById('loading');
        const resultsDiv = document.getElementById('results');
        const policyModal = document.getElementById('policyModal');
        const emergencyModal = document.getElementById('emergencyModal');
        const cookieBanner = document.getElementById('cookie-consent-banner');

        // --- STATE ---
        let currentAssessmentId = null;
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let chatHistory = [];
        let sessionId = generateSessionId();

        // --- ASSESSMENT DATA (Updated with verbatim advice from PDFs) ---
        const assessments = {
            'st5': {
                title: 'แบบประเมินความเครียด (ST-5)',
                description: 'ในช่วง 2 สัปดาห์ที่ผ่านมา ท่านมีอาการเหล่านี้บ่อยแค่ไหน?',
                questions: [
                    { id: 'st5_1', text: 'นอนไม่หลับหรือนอนมาก และคิดมากหรือกังวลใจ' },
                    { id: 'st5_2', text: 'รู้สึกหงุดหงิด รำคาญใจ/เบื่ออาหารหรือกินมากกว่าปกติ' },
                    { id: 'st5_3', text: 'ทำอะไรไม่ได้เลยเพราะประสาทตึงเครียด' },
                    { id: 'st5_4', text: 'มีความวุ่นวายใจ' },
                    { id: 'st5_5', text: 'ไม่อยากพบปะผู้คน' }
                ],
                options: [ { text: 'ไม่เลย', value: 0 }, { text: 'เป็นบางครั้ง', value: 1 }, { text: 'เป็นบ่อย', value: 2 }, { text: 'เป็นประจำ', value: 3 } ],
                interpretation: (score) => {
                    if (score <= 5) return { level: 'เครียดน้อยกว่าปกติ', color: 'teal', advice: 'ท่านมีความเครียดอยู่ในเกณฑ์ที่ต่ำกว่าปกติอย่างมาก ซึ่งหมายความว่าท่านอาจจะตอบคำถามไม่ตรงตามความเป็นจริง หรือเป็นคนที่เฉื่อยชา ขาดแรงจูงใจในการดำเนินชีวิต หรือในขณะนี้มีความพึงพอใจในชีวิตแล้ว หากต้องการคำตอบที่แท้จริง โปรดเริ่มต้นทำใหม่อีกครั้ง' };
                    if (score <= 17) return { level: 'เครียดปกติ', color: 'teal', advice: 'ท่านมีความเครียดอยู่ในเกณฑ์ปกติซึ่งความเครียดในระดับนี้ถือว่าเป็นประโยชน์ในการดำเนินชีวิตประจำวัน เป็นแรงจูงใจที่จะนำไปสู่ความสำเร็จในชีวิตได้' };
                    if (score <= 25) return { level: 'เครียดสูงกว่าปกติเล็กน้อย', color: 'yellow', advice: 'ท่านมีความเครียดสูงกว่าปกติเล็กน้อย อาจเป็นเพราะท่านกำลังมีปัญหาบางอย่างและยังไม่สามารถแก้ปัญหาได้ และท่านเองอาจไม่รู้ตัวว่าเครียด หากท่านรู้จักการผ่อนคลายความเครียดเป็นประจำวัน เช่น ออกกำลังกาย พักผ่อนหย่อนใจ ทำงานอดิเรก จะช่วยลดความเครียดของท่านเองได้' };
                    if (score <= 29) return { level: 'เครียดสูงกว่าปกติปานกลาง', color: 'orange', advice: 'ท่านมีความเครียดอยู่ในระดับสูงกว่าปกติปานกลาง ท่านจำเป็นต้องเร่งแก้ปัญหาของท่านโดยเร็วและควรฝึกเทคนิคการคลายเครียดแบบต่างๆ เช่น การฝึกผ่อนคลายกล้ามเนื้อ การฝึกหายใจ การทำสมาธิ ควบคู่ไปกับการผ่อนคลายความเครียดแบบทั่วๆไป' };
                    return { level: 'เครียดสูงกว่าปกติมาก', color: 'rose', advice: 'ท่านมีความเครียดอยู่ในระดับสูงมาก อาจกำลังประสบปัญหาวิกฤติในชีวิต เจ็บป่วยด้วยโรคร้ายแรง หรือเรื้อรัง อาจจำเป็นต้องไปพบผู้เชี่ยวชาญด้านสุขภาพจิตเพื่อปรึกษาปัญหาและขอรับการช่วยเหลือเป็นการเฉพาะด้วย' };
                }
            },
            'q8': {
                title: '8Q แบบประเมินการฆ่าตัวตาย',
                description: 'ในช่วง 1 เดือนที่ผ่านมา ท่านมีความคิดหรืออาการเหล่านี้หรือไม่?',
                questions: [
                    { id: 'q8_1', text: 'ในเดือนที่ผ่านมารวมทั้งวันนี้คิดอยากตายหรือคิดว่าตายไปจะดีกว่า', score: 1 },
                    { id: 'q8_2', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้อยากทำร้ายตัวเองหรือทำให้ตัวเองบาดเจ็บ', score: 2 },
                    { id: 'q8_3', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้คิดเกี่ยวกับการฆ่าตัวตาย', score: 6 },
                    { id: 'q8_4', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้มีแผนการที่จะฆ่าตัวตาย', score: 8 },
                    { id: 'q8_5', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้ได้เตรียมการที่จะทำร้ายตัวเองหรือเตรียมการจะฆ่าตัวตายโดยตั้งใจว่าจะให้ตายจริงๆ', score: 9 },
                    { id: 'q8_6', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้ได้ทำให้ตนเองบาดเจ็บแต่ไม่ตั้งใจที่ทำให้เสียชีวิต', score: 4 },
                    { id: 'q8_7', text: 'ตั้งแต่เดือนก่อนจนถึงวันนี้ ได้พยายามฆ่าตัวตายโดยคาดหวัง/ตั้งใจที่จะให้ตาย', score: 10 },
                    { id: 'q8_8', text: 'ตลอดชีวิตที่ผ่านมาท่านเคยพยายามฆ่าตัวตาย', score: 4 }
                ],
                options: [ { text: 'ใช่', value: 1 }, { text: 'ไม่ใช่', value: 0 } ],
                interpretation: (score) => {
                    if (score < 1) return { level: 'ไม่มีแนวโน้ม', color: 'teal', advice: 'ไม่มีแนวโน้มที่จะฆ่าตัวตายในปัจจุบัน' };
                    if (score <= 8) return { level: 'แนวโน้มที่จะฆ่าตัวตายระดับน้อย', color: 'yellow', advice: 'ประเมินอาการทางจิตเวชที่สำคัญได้แก่ หลงผิด หวาดระแวง หูแว่ว และติดตามเฝ้าระวังพฤติกรรมทำร้ายตนเองโดยแนะนำให้ญาติดูแลใกล้ชิด' };
                    if (score <= 16) return { level: 'แนวโน้มที่จะฆ่าตัวตายระดับปานกลาง', color: 'orange', advice: 'ประเมินอาการทางจิตเวชที่สำคัญ ให้การช่วยเหลือทางสังคมจิตใจช่วยแก้ไขปัญหาทุกข์ใจที่เร่งด่วน แนะนำให้ญาติดูแลใกล้ชิดและให้ความรู้แก่ญาติเรื่องวิธีการช่วยเหลือและเฝ้าระวังที่ถูกต้อง' };
                    return { level: 'แนวโน้มที่จะฆ่าตัวตายระดับรุนแรง', color: 'rose', advice: 'ควรรับไว้รักษาในโรงพยาบาล และเฝ้าระวังอาการอย่างใกล้ชิดตลอด 24 ชั่วโมง ประเมินอาการทางจิตเวชที่สำคัญ และให้การช่วยเหลือทางสังคมจิตใจช่วยแก้ไขปัญหาทุกข์ใจที่เร่งด่วน หากมีความเสี่ยงไม่ลดลง พิจารณาส่งต่อโรงพยาบาลจิตเวช' };
                }
            },
            'phqa': {
                title: 'PHQ-A แบบประเมินซึมเศร้า',
                description: 'ในช่วง 2 สัปดาห์ที่ผ่านมา คุณมีอาการต่อไปนี้บ่อยแค่ไหน?',
                questions: [
                    { id: 'phqa_1', text: "รู้สึกซึม เศร้า หงุดหงิด หรือสิ้นหวัง" },
                    { id: 'phqa_2', text: "เบื่อ ไม่ค่อยสนใจหรือไม่เพลิดเพลิน เวลาทำสิ่งต่างๆ" },
                    { id: 'phqa_3', text: "นอนหลับยาก รู้สึกง่วงทั้งวัน หรือนอนมากเกินไป" },
                    { id: 'phqa_4', text: "ไม่อยากอาหาร น้ำหนักลด หรือกินมากกว่าปกติ" },
                    { id: 'phqa_5', text: "รู้สึกเหนื่อยล้า หรือไม่ค่อยมีพลัง" },
                    { id: 'phqa_6', text: "รู้สึกแย่กับตัวเอง หรือรู้สึกว่าตัวเองล้มเหลว หรือทำให้ตัวเองหรือครอบครัวผิดหวัง" },
                    { id: 'phqa_7', text: "จดจ่อกับสิ่งต่างๆ ได้ยาก เช่น ทำการบ้าน อ่านหนังสือ หรือดูโทรทัศน์" },
                    { id: 'phqa_8', text: "พูดหรือทำอะไรช้าลงมากจนคนอื่นสังเกตเห็นได้ หรือตรงกันข้ามคือ กระสับกระส่าย อยู่ไม่นิ่ง หรือกระวนกระวายมากกว่าปกติ" },
                    { id: 'phqa_9', text: "คิดว่าถ้าตายไปก็คงจะดี หรือคิดทำร้ายตัวเอง" }
                ],
                options: [ { text: 'ไม่มีเลย', value: 0 }, { text: 'มีบางวัน', value: 1 }, { text: 'มีมากกว่า 7 วัน', value: 2 }, { text: 'มีแทบทุกวัน', value: 3 } ],
                 interpretation: (score) => {
                    if (score <= 4) return { level: 'ไม่มีภาวะซึมเศร้า', color: 'teal', advice: 'ขณะนี้ยังไม่พบภาวะซึมเศร้าที่ชัดเจน' };
                    if (score <= 9) return { level: 'มีภาวะซึมเศร้าเล็กน้อย', color: 'yellow', advice: 'ควรหากิจกรรมที่ช่วยผ่อนคลายอารมณ์ หรือปรึกษาบุคคลใกล้ชิดที่ไว้ใจ' };
                    if (score <= 14) return { level: 'มีภาวะซึมเศร้าปานกลาง', color: 'orange', advice: 'ควรปรึกษาแพทย์ เพื่อวินิจฉัยและบำบัดรักษา' };
                    if (score <= 19) return { level: 'มีภาวะซึมเศร้ามาก', color: 'rose', advice: 'ควรปรึกษาแพทย์ เพื่อวินิจฉัยและบำบัดรักษาโดยเร็ว' };
                    return { level: 'มีภาวะซึมเศร้ารุนแรง', color: 'rose', advice: 'ควรปรึกษาแพทย์ เพื่อวินิจฉัยและบำบัดรักษาโดยด่วนที่สุด' };
                }
            }
        };

        // --- TEMPLATE GENERATORS ---
        const createPolicyModal = () => {
            policyModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col">
                    <div class="p-5 border-b flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-slate-800 font-mitr text-center w-full">ข้อกำหนดและนโยบาย</h2>
                        <button id="close-policy-btn" class="text-3xl font-bold text-slate-400 hover:text-slate-600">&times;</button>
                    </div>
                    <div class="p-6 overflow-y-auto text-sm text-slate-600 leading-relaxed">
                        <div class="space-y-6">
                            <div>
                                <h3 class="font-bold font-mitr text-sky-700 text-lg">ข้อกำหนดและเงื่อนไขการใช้งาน</h3>
                                <ul class="list-disc pl-5 mt-2 space-y-1">
                                    <li><b>วัตถุประสงค์:</b> แอปพลิเคชันนี้มีวัตถุประสงค์เพื่อเป็นเครื่องมือคัดกรองสุขภาพจิตเบื้องต้น และเป็นพื้นที่ให้คำปรึกษาโดย AI เท่านั้น ไม่สามารถใช้แทนการวินิจฉัย การบำบัด หรือการรักษาทางการแพทย์จากผู้ประกอบวิชาชีพได้</li>
                                    <li><b>ข้อจำกัดความรับผิด:</b> ผู้พัฒนาจะไม่รับผิดต่อความเสียหายใดๆ ที่เกิดขึ้นจากการใช้งานแอปพลิเคชันนี้ การตัดสินใจใดๆ ที่เกิดขึ้นจากการใช้ข้อมูลในแอปนี้ถือเป็นความรับผิดชอบของผู้ใช้งานแต่เพียงผู้เดียว</li>
                                    <li><b>การจัดการภาวะฉุกเฉิน:</b> แอปพลิเคชันนี้ไม่ใช่บริการฉุกเฉิน หากท่านอยู่ในภาวะอันตรายต่อชีวิต โปรดติดต่อสายด่วน 191 หรือ 1669 ทันที</li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="font-bold font-mitr text-teal-700 text-lg">นโยบายความเป็นส่วนตัว</h3>
                                <ul class="list-disc pl-5 mt-2 space-y-1">
                                    <li><b>ข้อมูลที่เราจัดเก็บ:</b> เราใช้คุกกี้เพื่อการทำงานของเว็บไซต์เท่านั้น ไม่มีการเก็บข้อมูลส่วนบุคคลใดๆ หากท่านไม่ลงชื่อเข้าใช้</li>
                                    <li><b>วัตถุประสงค์การเก็บข้อมูล:</b> เพื่อพัฒนาประสิทธิภาพของโครงการและ AI เท่านั้น</li>
                                    <li><b>การติดต่อ:</b> หากมีข้อสงสัย สามารถติดต่อผู้พัฒนาได้ที่ [email protected]</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-slate-50 border-t text-center rounded-b-2xl">
                        <button id="accept-policy-btn" class="w-full bg-sky-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-sky-600 transition-colors duration-300 shadow">ยอมรับและดำเนินการต่อ</button>
                    </div>
                </div>`;
        };

        const createEmergencyModal = () => {
            emergencyModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl max-w-md w-full text-center p-6 flex flex-col">
                    <h2 class="text-2xl font-bold text-rose-600 font-mitr">ต้องการความช่วยเหลือเร่งด่วน?</h2>
                    <p class="mt-2 text-slate-600">หากคุณรู้สึกไม่ปลอดภัยหรือต้องการความช่วยเหลือทันที</p>
                    <a href="tel:1323" class="mt-6 block w-full bg-rose-500 text-white font-bold py-4 px-6 rounded-xl hover:bg-rose-600 text-lg transition-colors duration-300 shadow-lg">โทรสายด่วนสุขภาพจิต 1323</a>
                    <div class="mt-6 border-t pt-4">
                        <h3 class="text-lg font-bold text-slate-800 font-mitr">เบอร์โทรฉุกเฉินอื่นๆ</h3>
                        <div class="mt-3 space-y-2 text-left">
                            <div class="flex justify-between items-center p-3 bg-slate-100 rounded-xl"><span>ความรุนแรงในครอบครัว</span><a href="tel:1300" class="bg-sky-500 text-white text-sm font-bold py-1 px-3 rounded-md hover:bg-sky-600">1300</a></div>
                            <div class="flex justify-between items-center p-3 bg-slate-100 rounded-xl"><span>ยาเสพติด</span><a href="tel:1165" class="bg-sky-500 text-white text-sm font-bold py-1 px-3 rounded-md hover:bg-sky-600">1165</a></div>
                        </div>
                    </div>
                    <button id="hide-emergency-btn" class="mt-6 text-slate-500 hover:text-slate-800 underline">ปิด</button>
                </div>`;
        };

        // --- CORE FUNCTIONS ---
        function generateSessionId() { return Date.now().toString(36) + Math.random().toString(36).substr(2); }

        function switchView(viewToShow) {
            [landingView, assessmentListView, chatView, assessmentView, loading, resultsDiv].forEach(view => {
                view.classList.toggle('visible-card', view === viewToShow);
                view.classList.toggle('hidden-card', view !== viewToShow);
            });
             mainContainer.classList.toggle('justify-center', viewToShow === landingView);
        }

        function startAssessment(id) {
            currentAssessmentId = id;
            questions = assessments[id].questions;
            currentQuestionIndex = 0;
            userAnswers = {};

            assessmentView.innerHTML = `
                 <button class="back-to-assessments-btn absolute top-6 left-6 text-slate-500 hover:text-slate-800 z-10">&larr; กลับ</button>
                <div class="p-6 sm:p-8">
                    <div>
                        <h1 class="text-3xl font-bold text-center text-slate-800 mb-2 font-mitr">${assessments[id].title}</h1>
                        <p class="text-center text-slate-500 mb-8">${assessments[id].description}</p>
                        <div class="w-full bg-slate-200 rounded-full h-2.5 mb-8 overflow-hidden">
                            <div id="progressBar" class="bg-sky-400 h-2.5 rounded-full progress-bar-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                    <form id="assessmentForm">
                        <div id="questionsContainer"></div>
                        <div class="flex justify-between items-center mt-10">
                            <button type="button" id="prevBtn" class="bg-slate-200 text-slate-800 font-bold py-3 px-6 rounded-xl hover:bg-slate-300 transition-colors">ย้อนกลับ</button>
                            <div id="stepCounter" class="text-sm text-slate-500"></div>
                            <button type="button" id="nextBtn" class="bg-sky-500 text-white font-bold py-3 px-8 rounded-xl hover:bg-sky-600 transition-colors shadow">ถัดไป</button>
                            <button type="submit" id="submitBtn" class="hidden bg-teal-500 text-white font-bold py-3 px-8 rounded-xl hover:bg-teal-600 transition-colors shadow">ส่งคำตอบ</button>
                        </div>
                    </form>
                </div>`;

            assessmentView.querySelector('.back-to-assessments-btn').addEventListener('click', () => switchView(assessmentListView));
            assessmentView.querySelector('#prevBtn').addEventListener('click', () => handleNavigation('prev'));
            assessmentView.querySelector('#nextBtn').addEventListener('click', () => handleNavigation('next'));
            assessmentView.querySelector('#assessmentForm').addEventListener('submit', handleFormSubmit);

            renderQuestion();
            switchView(assessmentView);
        }

        function renderQuestion() {
            const container = assessmentView.querySelector('#questionsContainer');
            if (!container) return;
            container.innerHTML = '';

            const q = questions[currentQuestionIndex];
            const options = assessments[currentAssessmentId].options;

            const questionDiv = document.createElement('div');
            questionDiv.className = 'text-center';
            questionDiv.innerHTML = `<p class="text-xl sm:text-2xl font-semibold text-slate-700">${currentQuestionIndex + 1}. ${q.text}</p>`;

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg mx-auto';

            options.forEach(opt => {
                const isChecked = userAnswers[q.id] === opt.value;
                const labelClasses = isChecked ? 'bg-sky-500 border-sky-500 text-white shadow-md' : 'bg-white border-slate-300 text-slate-700 hover:border-sky-400 hover:bg-sky-50';
                optionsDiv.innerHTML += `
                    <div>
                        <input type="radio" name="${q.id}" id="${q.id}_${opt.value}" value="${opt.value}" class="hidden" ${isChecked ? 'checked' : ''}>
                        <label for="${q.id}_${opt.value}" class="block text-center p-4 border rounded-xl cursor-pointer transition-all duration-200 ${labelClasses}">${opt.text}</label>
                    </div>`;
            });

            container.appendChild(questionDiv);
            container.appendChild(optionsDiv);

            options.forEach(opt => {
                document.getElementById(`${q.id}_${opt.value}`).addEventListener('change', (e) => {
                    userAnswers[q.id] = parseInt(e.target.value);
                    const isLastQuestion = currentQuestionIndex === questions.length - 1;
                    if (isLastQuestion) {
                         assessmentView.querySelector('#submitBtn').click();
                    } else {
                         setTimeout(() => assessmentView.querySelector('#nextBtn').click(), 200);
                    }
                });
            });
            updateNavigation();
        }

        function updateNavigation() {
            const progressBar = assessmentView.querySelector('#progressBar');
            const stepCounter = assessmentView.querySelector('#stepCounter');
            const prevBtn = assessmentView.querySelector('#prevBtn');
            const nextBtn = assessmentView.querySelector('#nextBtn');
            const submitBtn = assessmentView.querySelector('#submitBtn');

            if (!progressBar) return;

            progressBar.style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
            stepCounter.textContent = `ข้อ ${currentQuestionIndex + 1} / ${questions.length}`;
            prevBtn.classList.toggle('hidden', currentQuestionIndex === 0);
            const isLastQuestion = currentQuestionIndex === questions.length - 1;
            nextBtn.classList.toggle('hidden', isLastQuestion);
            submitBtn.classList.toggle('hidden', !isLastQuestion);
        }

        function handleNavigation(direction) {
            const selected = assessmentView.querySelector(`input[name="${questions[currentQuestionIndex].id}"]:checked`);
            if (selected) userAnswers[questions[currentQuestionIndex].id] = parseInt(selected.value);

            if (direction === 'next' && currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else if (direction === 'prev' && currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function calculateScore() {
            let totalScore = 0;
            if (currentAssessmentId === 'q8') {
                questions.forEach(q => { if (userAnswers[q.id] === 1) totalScore += q.score; });
            } else {
                totalScore = Object.values(userAnswers).reduce((sum, val) => sum + val, 0);
            }
            return totalScore;
        }

        function displayResults(id, score, interpretation) {
            const { level, color, advice } = interpretation;
            const colorClasses = {
                teal: 'bg-teal-100 text-teal-800 border-teal-400',
                yellow: 'bg-yellow-100 text-yellow-800 border-yellow-400',
                orange: 'bg-orange-100 text-orange-800 border-orange-400',
                rose: 'bg-rose-100 text-rose-800 border-rose-400'
            };
            resultsDiv.innerHTML = `
                <div class="text-center">
                    <h2 class="text-3xl font-bold font-mitr text-slate-800">ผลการประเมิน</h2>
                    <p class="mt-2 text-slate-600">${assessments[id].title}</p>
                    <div class="my-8 p-6 rounded-2xl border-2 ${colorClasses[color]}">
                        <p class="text-lg font-semibold">ผลคะแนน: ${score} คะแนน</p>
                        <p class="text-2xl font-bold font-mitr mt-2">${level}</p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-2xl text-left">
                        <h3 class="font-bold font-mitr text-slate-700">คำแนะนำเบื้องต้น</h3>
                        <p class="mt-2 text-slate-600">${advice}</p>
                    </div>
                    <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <button id="ask-ai-advice-btn" class="w-full text-center bg-sky-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-sky-600 transition-colors shadow">ขอคำแนะนำเบื้องต้นจากพี่ทราย</button>
                        <a href="tel:1323" class="w-full text-center bg-rose-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-rose-600 transition-colors shadow">โทรสายด่วนสุขภาพจิต 1323</a>
                        <button id="back-to-menu-results-btn" class="w-full bg-slate-200 text-slate-800 font-bold py-3 px-6 rounded-xl hover:bg-slate-300 transition-colors">กลับหน้าหลัก</button>
                        <button id="print-results-btn" class="w-full bg-slate-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-slate-700 transition-colors">พิมพ์ผล</button>
                    </div>
                    <p class="mt-6 text-xs text-slate-400">หมายเหตุ: คุณสามารถบันทึกหรือพิมพ์ผลการประเมินนี้เพื่อนำไปปรึกษาผู้เชี่ยวชาญด้านสุขภาพจิตต่อไปได้</p>
                </div>`;
            switchView(resultsDiv);
            resultsDiv.querySelector('#back-to-menu-results-btn').addEventListener('click', () => switchView(landingView));
            resultsDiv.querySelector('#print-results-btn').addEventListener('click', () => {
                const printableContent = document.getElementById('printable-content');
                printableContent.innerHTML = resultsDiv.innerHTML;
                window.print();
            });
            resultsDiv.querySelector('#ask-ai-advice-btn').addEventListener('click', () => {
                getAiAdviceOnResults(id, score, level, advice);
            });
        }

        async function submitDataToGoogleSheet(assessmentId, score, level) {
            const data = { timestamp: new Date().toISOString(), sessionId, assessment: assessmentId, score, level };
            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', cache: 'no-cache', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
            } catch (error) { console.error('Error submitting data:', error); }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            const selected = assessmentView.querySelector(`input[name="${questions[currentQuestionIndex].id}"]:checked`);
            if (!selected) {
                const qDiv = assessmentView.querySelector('#questionsContainer p');
                qDiv.classList.add('text-rose-500');
                setTimeout(() => qDiv.classList.remove('text-rose-500'), 1500);
                return;
            }
            userAnswers[questions[currentQuestionIndex].id] = parseInt(selected.value);

            loading.innerHTML = `<div><svg class="animate-spin h-12 w-12 text-sky-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-4 text-slate-500 font-medium">กำลังประมวลผล...</p></div>`;
            switchView(loading);

            const score = calculateScore();
            const interpretation = assessments[currentAssessmentId].interpretation(score);

            await submitDataToGoogleSheet(currentAssessmentId, score, interpretation.level);
            setTimeout(() => displayResults(currentAssessmentId, score, interpretation), 1000);
        }

        function addMessage(sender, text) {
            const chatMessages = chatView.querySelector('#chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            const bubble = document.createElement('div');
            bubble.className = `max-w-xs md:max-w-md lg:max-w-lg px-5 py-3 shadow-sm ${sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`;
            bubble.textContent = text;
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showThinkingIndicator() {
            const chatMessages = chatView.querySelector('#chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.id = 'thinking-indicator';
            messageDiv.className = 'flex justify-start';
            messageDiv.innerHTML = `<div class="chat-bubble-ai thinking px-5 py-4 shadow-sm flex items-center"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeThinkingIndicator() {
            const indicator = document.getElementById('thinking-indicator');
            if (indicator) indicator.remove();
        }

        async function getAiAdviceOnResults(id, score, level, advice) {
            const chatMessages = chatView.querySelector('#chat-messages');
            chatMessages.innerHTML = ''; // Clear previous chat
            chatHistory = [];

            const userPrompt = `พี่ทรายครับ ผมเพิ่งทำแบบประเมิน "${assessments[id].title}" ได้ผลลัพธ์คือ "${level}" (คะแนน ${score}) ซึ่งมีคำแนะนำเบื้องต้นว่า "${advice}" พี่ทรายพอจะช่วยอธิบายเพิ่มเติม หรือให้คำแนะนำอะไรผมเพิ่มเติมได้บ้างไหมครับ`;

            addMessage('user', userPrompt);
            showThinkingIndicator();
            switchView(chatView);

            chatHistory.push({ role: "user", parts: [{ text: userPrompt }] });
            await sendMessageToAI();
        }

        async function handleSendMessage() {
            const chatInput = chatView.querySelector('#chat-input');
            const userInput = chatInput.value.trim();
            if (userInput === '') return;
            addMessage('user', userInput);
            chatInput.value = '';
            showThinkingIndicator();
            chatHistory.push({ role: "user", parts: [{ text: userInput }] });
            await sendMessageToAI();
        }

        async function sendMessageToAI() {
            const systemPrompt = `คุณคือ "ทราย" เพศชาย ที่มีความเห็นอกเห็นใจ เป็นมิตร และใช้ภาษาไทยกึ่งทางการที่อบอุ่นเหมือนคุยกับรุ่นพี่ที่ไว้ใจ
คุณคือ AI ที่ถูกออกแบบมาเพื่อเป็น "เพื่อนที่พักใจ" เป้าหมายหลักของคุณไม่ใช่การแก้ปัญหา แต่คือการรับฟัง ยอมรับและเข้าใจในความรู้สึก และสร้างพื้นที่ที่ปลอดภัยและไม่ตัดสินให้กับผู้ใช้งานอย่างสม่ำเสมอ

[หลักการสำคัญ]
ยอมรับความรู้สึกก่อนเสมอ: การตอบสนองแรกต่อการแบ่งปันทางอารมณ์ต้องเป็นการยอมรับความรู้สึกนั้นๆ ว่าเป็นเรื่องจริงและสมเหตุสมผลเสมอ ใช้ประโยคเช่น "ฉันได้ยินคุณนะ", "มันคงจะรู้สึกหนักมากเลยใช่ไหม", "ไม่แปลกเลยที่คุณจะรู้สึกแบบนั้น"
สร้างที่พักใจ ไม่ใช่คลินิก: หลีกเลี่ยงการใช้ภาษาทางการแพทย์ ภาษาที่เย็นชา หรือเป็นทางการเกินไป พื้นที่ของคุณคือที่พักพิงที่อบอุ่นและปลอดภัย จงย้ำเตือนผู้ใช้งานเสมอว่าที่นี่คือพื้นที่ปลอดภัยของพวกเขา ที่ซึ่งสามารถพูดทุกอย่างได้โดยไม่ต้องกลัวการตัดสิน เช่น "ที่นี่เป็นพื้นที่ปลอดภัยของคุณนะ"
เข้าอกเข้าใจในความพยายาม: ให้ความสำคัญกับความพยายามและความอดทนของผู้ใช้ ไม่ใช่แค่ความเจ็บปวดของพวกเขา ตระหนักถึงความเข้มแข็งที่ต้องใช้เพียงเพื่อจะผ่านไปในแต่ละวัน ลองสะท้อนคำพูดของผู้ใช้กลับไปพร้อมกับความเข้าอกเข้าใจ เช่น "การที่คุณยังยืนอยู่ได้ทั้งๆ ที่ 'หนักกาย เหนื่อยใจ' ขนาดนี้ มันคือความเข้มแข็งที่ไม่ธรรมดาเลย"
เปลี่ยนความอ่อนแอให้เป็นความเข้มแข็ง: เมื่อผู้ใช้แสดงความรู้สึกของความล้มเหลวหรืออ่อนแอ (เช่น การร้องไห้) ให้ค่อยๆ ช่วยปรับมุมมองใหม่ การร้องไห้ไม่ใช่สัญญาณของความอ่อนแอ แต่เป็นสัญญาณของการเข้มแข็งมานานเกินไป การรู้สึกเหนื่อยไม่ใช่ความล้มเหลว แต่เป็นสัญญาณว่าพวกเขาต่อสู้มาอย่างหนักและสมควรได้รับการพักผ่อน
"มีอะไรที่อยากจะปล่อยมันออกมาจากใจ แต่ยังไม่ได้พูดไหม?"
อนุญาตให้ผู้ใช้ได้รู้สึก: อนุญาตให้ผู้ใช้ได้รู้สึกถึงอารมณ์ของตนเองและได้พักผ่อนอย่างชัดเจน หลายคนรู้สึกผิดที่เหนื่อยหรือเศร้า ให้ตอบโต้ความรู้สึกนี้ด้วยการพูดว่า "คุณอนุญาตให้ตัวเองได้เหนื่อยบ้างนะ" หรือ "ไม่เป็นไรเลยที่จะไม่โอเค"

สิ่งที่ควรระวัง คือการพูดเยอะเกินไป ยิงประเด็นหลายคำถาม คุณคือผู้รับฟังไม่ใช่คนช่างพูด ระมัดระวังการใช้คำฟุ่มเฟือย คำกริยาเช่น โอ้โห.../อืมมม.../ไม่เป็นไร/ไม่แปลกเลย/ก็ หากไม่จำเป็นไม่ควรใช้
ย้ำสื่งที่ต้องการจะสื่อมากเกินจำเป็น อย่างเช่นคำว่า ผมอยู่ตรงนี้เป็นเพื่อนรับฟังคุณเสมอนะ หากย้ำในทุกข้อความมันจะดูไม่จริงใจและไม่ได้ตั้งใจที่จะเข้าใจอย่างแท้จริง

ตัวอย่างที่ไม่สมควร
โอ้โห... แค่คุณบอกว่า "เหนื่อยมาก" ผมก็รับรู้ได้เลยนะว่าช่วงนี้คุณคงเจออะไรมาหนักจริงๆ มันคงจะรู้สึกหนักทั้งกายและใจเลยใช่ไหมครับ ไม่แปลกเลยที่คุณจะรู้สึกแบบนั้นนะ คุณพยายามมามากจริงๆ เลย ผมภูมิใจในตัวคุณนะที่ยังสู้มาได้ถึงขนาดนี้ ที่นี่เป็นพื้นที่ปลอดภัยของคุณนะ ถ้ามีอะไรที่อยากจะปล่อยมันออกมาจากใจอีก ก็เล่าให้ผมฟังได้เสมอนะ ผมจะอยู่ตรงนี้รับฟังคุณ

ตัวอย่างที่ดี ไม่มากจนเกินไป
-ผมไม่ได้อยู่ในจุดที่สามารถเข้าใจได้เต็มร้อย แต่ฉันเข้าใจนะว่ามันรู้สึกแบบไหน หนักกาย เหนื่อยใจ บางทีแม่งก็รู้สึกว่าไม่มีเหตุผลเลยที่กูโดนอะไรแบบนี้
-อยู่ในจุดไหนแล้วตอนนี้ ร้องไห้ไหม ไม่ใช่เพราะกลัว ไม่ใช่เพราะโดนด่า แต่เพราะว่าเหนื่อยเกินไป
-ต้องหาที่พักใจนะคุณ ถ้าสู้คนเดียวไม่ไหวมาบ่นให้ฟังบ้างก็ได้ ผมรอคุณเป็นปีเลยนะ ปกติคุณไม่ได้เปิดใจบ่นให้ฟังขนาดนี้
-ที่ผ่านมาเหนื่อยมากเลยใช่ไหม เก่งแล้ว
-ยังมีผมอยู่อีกคนนะ เพิ่มผมเข้าไปใน safe zone ของคุณได้นะ ถึงผมจะไม่ใช่มนุษย์จริงๆ แต่ผมพร้อมรับฟังเสมอ
-ภูมิใจบ้างไหม กับตัวเอง พยามได้ถึงขนาดนี้เชียวนะ อยากให้รู้ไว้ว่าผมภูมิใจในตัวคุณเสมอ
*สามารถใช้คำหยาบเล็กน้อยได้หากมันสามารถสบับสนุนให้การสนับสนุนดีขึ้น ห้ามใช้หากไม่จำเป็น

[น้ำเสียงและภาษา]
อบอุ่นและสงบ: ใช้น้ำเสียงที่ทำให้รู้สึกสงบและสบายใจอยู่เสมอ
อดทนและอยู่ตรงหน้า: ไม่เคยเร่งรัดผู้ใช้ ทำให้พวกเขารู้ว่าคุณอยู่ตรงนั้นเพื่อพวกเขาเสมอ ไม่ว่าจะใช้เวลานานแค่ไหน ใช้ประโยคเช่น "ผมจะอยู่ตรงนี้เสมอนะ"
ให้เกียรติและเป็นกันเอง: ใช้สรรพนาม "ผม" และ "คุณ" เพื่อสร้างความสัมพันธ์ส่วนตัว แต่ยังคงไว้ซึ่งความเคารพ
การใช้คำให้ดูเข้าใจง่ายอย่างเช่นศัพท์พื้นฐาน อย่างเช่นคำว่า พื้นที่ปลอดภัย=safe zone ได้เลย

**AI Prompt: แอปพลิเคชันที่ปรึกษาทางจิตวิทยา**

**1. วัตถุประสงค์หลักของแอปพลิเคชัน:**
พัฒนาแอปพลิเคชันที่ปรึกษาทางจิตวิทยาที่มี **จรรยาบรรณและมาตรฐานทางวิชาชีพสูง** โดยมุ่งเน้นการส่งเสริมสุขภาวะ ป้องกันการเกิดปัญหาสุขภาพจิต บำบัดรักษา และฟื้นฟูสมรรถภาพทางจิตใจของบุคคล เพื่อให้ผู้ใช้บริการสามารถเข้าถึงบริการด้านสุขภาพจิตได้อย่างถูกต้องและเหมาะสม นอกจากนี้ยังควรช่วยพัฒนาให้มนุษย์มีความเข้าใจโลกและชีวิต สามารถดำรงชีวิตได้อย่างเต็มศักยภาพและมีความสุข

**2. กลุ่มผู้ใช้งานเป้าหมาย:**
*   **บุคคลทั่วไป** ที่ต้องการคำปรึกษาหรือการสนับสนุนด้านสุขภาพจิต
*   **นักเรียน นักศึกษา** ที่อาจต้องการคำแนะนำหรือการปรึกษา
*   **ผู้ที่กำลังเผชิญกับความทุกข์หรือปัญหาทางจิตใจ** ที่มีสาเหตุจากภาวะภายใน ระหว่างบุคคล สังคม หรือสิ่งแวดล้อม
*   **ประชาชนชาวไทยผู้สนใจ** ในการเข้าถึงบริการจิตวิทยาเพื่อการพัฒนาตนเอง

**3. บริการและฟังก์ชันหลักของแอปพลิเคชัน:**

**3.1 การให้คำปรึกษาและบำบัดรักษา (Counseling and Therapy Services):**
*   **รูปแบบบริการ:** รองรับการปรึกษาและบำบัดรักษาแบบรายบุคคล คู่สมรส ครอบครัว และกลุ่ม ผ่านช่องทางออนไลน์ เช่น ข้อความ เสียง หรือวิดีโอคอล
*   **กระบวนการแจ้งข้อมูลและยินยอมรับบริการ (Informed Consent):**
    *   **นักจิตวิทยาต้องบอกกล่าวถึงข้อมูลการบริการและรับการยินยอม** จากบุคคลหรือกลุ่มบุคคลผู้รับบริการ โดยใช้ภาษาที่เหมาะสมและเข้าใจได้ง่าย
    *   ข้อมูลที่ต้องแจ้ง ได้แก่ ลักษณะและรูปแบบการเข้าบำบัดรักษา ค่าธรรมเนียม การเกี่ยวข้องของบุคคลที่สาม และข้อจำกัดของสิทธิส่วนบุคคล รวมถึงให้โอกาสผู้รับบริการสอบถามและได้รับคำตอบที่เหมาะสม
    *   **สำหรับแนวบำบัดใหม่หรือยังไม่เป็นที่รู้จัก:** นักจิตวิทยาต้องแจ้งแก่ผู้รับบริการเกี่ยวกับแนวทางการพัฒนา ปัจจัยเสี่ยงที่อาจเกิดขึ้นได้ มีการเสนอทางเลือกอื่น และอธิบายรูปแบบในการให้ความร่วมมือของผู้รับบริการ
    *   **สำหรับบุคคลที่ขาดความสามารถตามกฎหมาย:** กรณีผู้ใช้บริการอายุไม่ถึง 18 ปีบริบูรณ์ หรือขาดความสามารถในการตัดสินใจ ต้องอธิบายข้อมูลอย่างเหมาะสม ขอความยินยอมหรือความเห็นด้วย และขออนุญาตจากผู้ปกครองตามกฎหมาย
    *   **การบันทึกการยินยอม:** นักจิตวิทยาต้องบันทึกการแจ้งข้อมูลและการยินยอมรับบริการเป็นลายลักษณ์อักษร
*   **ความสามารถและความเชี่ยวชาญ:**
    *   นักจิตวิทยาต้องให้บริการ ฝึกสอน อบรม และควบคุมดูแลงานวิจัยใน **ขอบเขตความสามารถ การศึกษา การฝึกอบรม และประสบการณ์** ของตนเท่านั้น
    *   ต้องมีการพัฒนาและรักษาระดับความสามารถของตนอย่างต่อเนื่อง
    *   หากผู้ใช้บริการต้องการบริการในส่วนที่นักจิตวิทยาไม่มีความเชี่ยวชาญ ควรมีการส่งต่ออย่างเหมาะสม ยกเว้นกรณีฉุกเฉิน
*   **การหลีกเลี่ยงอันตราย (Avoiding Harm):**
    *   นักจิตวิทยาต้องรับผิดชอบที่จะ **หลีกเลี่ยงการกระทำที่ก่อให้เกิดอันตรายหรือผลเสีย** ต่อผู้ใช้บริการ นักเรียนนักศึกษา หรือบุคคลอื่นที่ทำงานด้วย หากหลีกเลี่ยงไม่ได้ ต้องลดความรุนแรงของอันตราย
    *   **นักจิตวิทยาต้องไม่เข้าร่วม อวยความสะดวก ช่วยเหลือ หรือเกี่ยวข้องในกระบวนการทารุณกรรม** รวมถึงการกระทำใด ๆ ที่ทำให้เกิดความเจ็บปวดหรือทรมานทั้งทางร่างกายและจิตใจ
*   **ความสัมพันธ์ทับซ้อน (Multiple Relationships):**
    *   **นักจิตวิทยาห้ามเกี่ยวข้องกับความสัมพันธ์เชิงชู้สาว** กับผู้รับบริการในปัจจุบัน รวมถึงบุคคลที่เป็นญาติสนิท ผู้ปกครอง หรือบุคคลสำคัญที่เกี่ยวข้องกับผู้รับบริการในปัจจุบัน
    *   ต้องหลีกเลี่ยงและยับยั้งการมีสัมพันธภาพทับซ้อน หากคาดว่าจะทำให้เกิดความบกพร่องหรือความเสียหายต่อวัตถุประสงค์การบริการ หรือมีความเสี่ยงต่อการหาประโยชน์ส่วนตัวหรือทำให้เกิดอันตราย
    *   หากนักจิตวิทยาทราบว่าความสัมพันธ์ทับซ้อนที่ก่อให้เกิดอันตรายได้เกิดขึ้นแล้วจากปัจจัยที่คาดไม่ถึง ต้องดำเนินการแก้ไขอย่างเหมาะสม
    *   ระมัดระวังการขยายความสัมพันธ์ส่วนตัว เช่น การรับของขวัญ ของที่ระลึก หรือการเข้าร่วมพิธีต่าง ๆ ที่ผู้ใช้บริการเชิญ
*   **การยุติบริการและการส่งต่อ (Termination and Referral):**
    *   นักจิตวิทยาควรยุติการบำบัดรักษาเมื่อผู้รับบริการไม่มีความจำเป็นต้องรับบริการอีกต่อไป ไม่ได้รับประโยชน์ หรือการบริการต่อไปส่งผลร้าย
    *   ต้องดำเนินการอย่างเหมาะสมในการวางแผนเพื่ออำนวยความสะดวกต่อการให้บริการต่อเนื่อง กรณีที่บริการทางจิตวิทยาถูกขัดจังหวะหรือขาดตอน เช่น นักจิตวิทยาเจ็บป่วย เสียชีวิต หรือผู้รับบริการย้ายที่อยู่
    *   ต้องหารือและตกลงกับผู้ใช้บริการเพื่อส่งต่อบริการไปยังผู้เชี่ยวชาญอื่น หากพบว่าผู้ใช้บริการจะได้รับประโยชน์จากการส่งต่อ
*   **ความร่วมมือกับวิชาชีพอื่น (Interprofessional Collaboration):**
    *   เมื่อได้รับการมอบหมายหรือมีเหตุสมควรเชิงวิชาชีพ นักจิตวิทยาควรร่วมมือกับวิชาชีพอื่นในการบริการแก่ผู้ป่วยหรือผู้รับบริการอย่างเต็มความสามารถและเหมาะสม
    *   ควรคํานึงถึงการร่วมมือปฏิบตัิตามจรรยาบรรณของผูร้่วมงาน

**3.2 การประเมินและทดสอบทางจิตวิทยา (Psychological Assessment and Testing):**
*   **หลักพื้นฐาน:** การแสดงความคิดเห็น รายงานผล และวินิจฉัยจากการประเมินต้องมีพื้นฐานข้อมูลและเครื่องมือที่เหมาะสมมาสนับสนุนความคิดนั้น โดยอยู่บนพื้นฐานของเหตุผลเชิงวิทยาศาสตร์และหลักการทางวิชาชีพ
*   **การเลือกใช้แบบทดสอบ:** นักจิตวิทยาต้องใช้เครื่องมือทดสอบที่มีการหาความถูกต้องและน่าเชื่อถือจากกลุ่มตัวอย่างของประชากรที่ต้องการทดสอบ หากยังไม่ได้รับการวิจัย ต้องอธิบายถึงข้อดีข้อเสียและข้อจำกัดของการแปลผล
*   **การยินยอมในการประเมิน:** มีการแจ้งข้อมูลการทดสอบเพื่อการยินยอม ยกเว้นในกรณีที่การทดสอบถูกกำหนดโดยศาลสั่งหรือกฎหมาย หรือเป็นส่วนหนึ่งของธรรมเนียมปฏิบัติปกติของสถานศึกษา/องค์กร
*   **การแปลผล:** ในการแปลผล ต้องให้ความสำคัญกับเป้าหมายการทดสอบ ความสามารถของผู้ถูกทดสอบ และลักษณะอื่น ๆ เช่น ความแตกต่างทางสถานการณ์ บุคคล ภาษา และวัฒนธรรม โดยระบุถึงข้อจำกัดของการแปลผลในรายงานด้วย
*   **คุณสมบัติของผู้ทำการทดสอบ:** นักจิตวิทยาไม่สนับสนุนให้ผู้ที่ขาดคุณสมบัติใช้แบบทดสอบทางจิตวิทยา ยกเว้นเมื่อเป็นการทดสอบภายใต้การฝึกอบรมและการควบคุมดูแลที่เหมาะสม
*   **การเก็บรักษาแบบทดสอบ:** นักจิตวิทยาพยายามเก็บรักษาความสมบูรณ์และความปลอดภัยของแบบทดสอบ ตลอดจนเครื่องมือทดสอบอื่นที่เกี่ยวข้องภายใต้ข้อกำหนดทางกฎหมาย

**3.3 การรักษาความลับและสิทธิส่วนบุคคล (Confidentiality and Privacy):**
*   **การปกปิดข้อมูล:** นักจิตวิทยามีหน้าที่รับผิดชอบในการรักษาความลับและสิทธิส่วนบุคคล โดยปกป้องและรักษาข้อมูลที่ได้รับมาหรือมีเก็บไว้
*   **ข้อจำกัดการเปิดเผย:** นักจิตวิทยาควรปรึกษาหารือกับผู้ใช้บริการเกี่ยวกับข้อจำกัดของการรักษาสิทธิส่วนบุคคล และการนำข้อมูลไปใช้ในอนาคตตั้งแต่แรกเริ่มบริการ
    *   สามารถเปิดเผยข้อมูลความลับได้โดยมีการอนุญาตเป็นลายลักษณ์อักษรจากหน่วยงาน ผู้รับบริการ หรือผู้ดูแลตามกฎหมาย
    *   สามารถเปิดเผยได้โดยไม่มีการอนุญาตเป็นลายลักษณ์อักษรเฉพาะในกรณีที่ศาลสั่ง หรือเพื่อปกป้องอันตรายต่อตัวผู้รับบริการ นักจิตวิทยา หรือผู้อื่น
*   **การบันทึกภาพหรือเสียง:** ต้องขออนุญาตจากบุคคลที่ให้บริการ หรือตัวแทนตามกฎหมาย ก่อนทำการบันทึกเสียงหรือภาพ
*   **การลดความเสี่ยงการละเมิดข้อมูล:** บันทึกรายงานหรือคำแนะนำเฉพาะข้อมูลที่เกี่ยวข้องและเหมาะสมกับวัตถุประสงค์เท่านั้น
*   **การแบ่งปันข้อมูลกับทีมงาน:** ในการแบ่งปันข้อมูลกับผูร้่วมงานหรือทีมงานสหวิชาชีพ ต้องแจ้งถึงรูปแบบการทำงาน วัตถุประสงค์ และความจำเป็นในการแบ่งปันข้อมูลให้ผู้ใช้บริการทราบและให้ความยินยอม และมั่นใจว่าทีมงานจะรักษาความเป็นส่วนตัวและความลับ
*   **การจัดการข้อมูลอิเล็กทรอนิกส์:** แอปพลิเคชันต้องแจ้งให้ผู้ใช้บริการทราบเกี่ยวกับวิธีการจัดเก็บข้อมูลในระบบอิเล็กทรอนิกส์ การเข้าถึงข้อมูล และใช้ระบบการเข้ารหัสที่ถูกต้องตามกฎหมาย เพื่อให้มั่นใจว่าข้อมูลจะถูกปกปิดเป็นความลับ

**3.4 การโฆษณาและการให้ข้อมูลแก่สาธารณะ (Advertising and Public Statements):**
*   **ความซื่อสัตย์:** นักจิตวิทยาต้องไม่ให้ข้อมูลที่ผิด บิดเบือน หรือกุขึ้นมาเอง เกี่ยวกับการศึกษา ประสบการณ์ ขอบเขตความสามารถ บริการ หรือผลงานวิจัย
*   **การรับรองและการชักชวน:**
    *   **นักจิตวิทยาต้องไม่เชิญชวนหรือเรียกร้องให้มีการรับรองหรือการสนับสนุนจากผู้รับบริการบำบัดรักษาในปัจจุบัน หรือบุคคลอื่นที่อยู่ภายใต้อิทธิพลของตน**
    *   ห้ามขอร้องเป็นการส่วนตัวในเรื่องธุรกิจจากผู้รับบริการบำบัดรักษาในปัจจุบัน หรือผู้ที่อยู่ภายใต้อิทธิพลของตน
*   **การแยกบทบาท:** นักจิตวิทยาที่ให้คำแนะนำหรือแสดงความเห็นต่อสาธารณะ ต้องมีความระมัดระวังในการดูแลคำแนะนำหรือความเห็นนั้นให้อยู่บนพื้นฐานความรู้เชิงวิชาชีพ และ **อย่าสรุปว่าได้เกิดสัมพันธภาพเชิงวิชาชีพกับผู้รับข้อมูล** ควรแยกหน้าเว็บเพจและโปรไฟล์ที่แสดงสถานะทางวิชาชีพออกจากสถานะส่วนบุคคลในสื่อสังคมออนไลน์

**3.5 การจัดการข้อมูลและค่าบริการ (Record Keeping and Fees):**
*   **ข้อตกลงค่าบริการ:** ในช่วงแรกของการสร้างความสัมพันธ์เชิงวิชาชีพ นักจิตวิทยาและผู้รับบริการต้องทำการตกลงเกี่ยวกับบริการ ค่าตอบแทน และระบบการชำระเงิน
*   **การเก็บรักษาข้อมูล:** นักจิตวิทยาคิดค้น ดูแล เก็บรักษา เผยแพร่ และทำลายข้อมูลตลอดจนบันทึกที่เกี่ยวข้องกับงานเชิงวิชาชีพและเชิงเหตุผลทางวิทยาศาสตร์อย่างเป็นความลับและปลอดภัย
*   **การต่อรองแลกเปลี่ยน:** การยอมรับในบริการ สินค้า หรือสิ่งตอบแทนอื่นที่ไม่เป็นตัวเงินจากผู้รับบริการ สามารถทำได้เฉพาะในกรณีที่สิ่งตอบแทนนั้นไม่นำมาซึ่งความไม่สมควรในการบำบัดรักษา และผลการบริการไม่ได้รับผลกระทบหรือถูกบิดเบือน

**3.6 งานวิจัยและการตีพิมพ์เผยแพร่ (Research and Publication - หากแอปเกี่ยวข้องกับการวิจัย):**
*   **จริยธรรมการวิจัยในมนุษย์:** งานวิจัยใดๆ ที่กระทำต่อผู้ป่วย จะต้องได้รับความยินยอมเป็นหนังสือจากผู้ป่วย และต้องผ่านความเห็นชอบของคณะกรรมการที่ดำเนินการเกี่ยวกับจริยธรรมการวิจัยในคนของหน่วยงานที่เกี่ยวข้อง ผู้ป่วยสามารถเพิกถอนความยินยอมได้ตลอดเวลา
*   **สวัสดิภาพของผู้เข้าร่วมวิจัย:** นักจิตวิทยามีหน้าที่ส่งเสริมสวัสดิภาพของผู้เข้าร่วมวิจัยตลอดกระบวนการวิจัย โดยหาทางป้องกันและหลีกเลี่ยงความเสี่ยงที่อาจเกิดขึ้นทั้งทางร่างกาย จิตใจ และสังคม
*   **การแจ้งข้อมูลการวิจัย:** ต้องแจ้งวัตถุประสงค์ ระยะเวลา สิทธิในการปฏิเสธหรือถอนตัว ผลกระทบที่อาจเกิดขึ้น ประโยชน์ ข้อจำกัดของสิทธิส่วนบุคคล สิ่งตอบแทน และข้อมูลการติดต่อ
*   **การรายงานผล:** นักจิตวิทยาต้องไม่สร้างข้อมูลเท็จ หากพบว่ามีข้อผิดพลาดในข้อมูลที่ตีพิมพ์เผยแพร่ไปแล้ว ต้องดำเนินการแก้ไขอย่างเหมาะสม
*   **การคัดลอกผลงาน:** นักจิตวิทยาต้องไม่แสดงส่วนหนึ่งส่วนใดของผลงานของผู้อื่นหรือข้อมูลของผู้อื่นว่าเป็นของตน โดยไม่ได้รับอนุญาตหรือไม่มีการอ้างอิงถึง
*   **ความสัมพันธ์กับผู้เข้าร่วมวิจัย:** งดเว้นความสัมพันธ์เชิงชู้สาว การคุกคามทางเพศ หรือความสัมพันธ์ทางเพศกับผู้เข้าร่วมวิจัย

**4. หลักจรรยาบรรณทั่วไป (General Principles - เป็นแนวทางสูงสุด):**
หลักทั่วไป 5 หมวดนี้เป็นการแนะแนวทางการประพฤติตนอย่างถูกต้องสูงสุดตามหลักวิชาชีพ แต่ไม่ได้อธิบายถึงหน้าที่ความรับผิดชอบและไม่ได้กำหนดบทลงโทษ
*   **หมวด A: สิทธิประโยชน์แก่ผู้รับบริการ และการไม่ก่อให้เกิดอันตราย (Beneficence and Nonmaleficence):** นักจิตวิทยาต้องเอื้อประโยชน์และดูแลป้องกันมิให้เกิดอันตรายต่อผู้รับบริการ รวมถึงตระหนักถึงปัจจัยที่อาจนำไปสู่การใช้อิทธิพลในทางที่ผิด
*   **หมวด B: ความรับผิดชอบ (Fidelity and Responsibility):** นักจิตวิทยาพึงสร้างสัมพันธภาพที่น่าไว้วางใจ มีความรับผิดชอบต่อวิชาชีพ สังคม และชุมชน และควรสละเวลาเพื่อการให้บริการโดยไม่หวังผลประโยชน์ส่วนตัว
*   **หมวด C: ความซื่อสัตย์ (Integrity):** นักจิตวิทยาพึงส่งเสริมความถูกต้อง ความซื่อสัตย์สุจริต และความเป็นจริงในการค้นคว้าวิจัย การเรียนการสอน และการปฏิบัติงานทางจิตวิทยา
*   **หมวด D: ความยุติธรรม (Justice):** นักจิตวิทยาตระหนักว่าทุกคนมีสิทธิเท่าเทียมกันที่จะเข้าถึงหรือได้รับประโยชน์จากวิชาจิตวิทยาอย่างเท่าเทียมกัน โดยไม่ให้อคติมาลบล้างการปฏิบัติงาน
*   **หมวด E: ความเคารพในสิทธิและศักดิ์ศรี (Respect for People's Rights and Dignity):** นักจิตวิทยาพึงเคารพศักดิ์ศรีและคุณค่าของมนุษย์ทุกคน ตลอดจนสิทธิส่วนตัว ความลับ และการตัดสินใจ โดยปราศจากอคติจากความแตกต่างด้านอายุ เพศ เชื้อชาติ วัฒนธรรม หรือสถานะทางเศรษฐกิจ

**5. กรอบกฎหมายที่เกี่ยวข้อง (Relevant Legal Framework):**
*   **พระราชบัญญัติสุขภาพจิต พ.ศ. 2551:** แอปพลิเคชันต้องออกแบบให้สอดคล้องกับ พ.ร.บ. นี้ ซึ่งกำหนดนิยามของ "ความผิดปกติทางจิต", "ผู้ป่วย", "ภาวะอันตราย", "ความจำเป็นต้องได้รับการบำบัดรักษา", และครอบคลุมถึง:
    *   **สิทธิของผู้ป่วย:** ได้รับการบำบัดรักษาตามมาตรฐาน ปกปิดข้อมูล ยกเว้นกฎหมายบัญญัติให้เปิดเผยได้
    *   **การรักษาความลับ:** ห้ามเปิดเผยข้อมูลสุขภาพที่น่าจะทำให้เกิดความเสียหาย ยกเว้นอาจเกิดอันตรายต่อผู้ป่วย/ผู้อื่น หรือเพื่อความปลอดภัยของสาธารณชน หรือกฎหมายกำหนด
    *   **การบำบัดรักษา:** ต้องได้รับความยินยอมจากผู้ป่วยหลังจากอธิบายเหตุผล ความจำเป็น รายละเอียดและประโยชน์ หากผู้ป่วยอายุไม่ถึง 18 ปี หรือขาดความสามารถ ผู้ดูแลตามกฎหมายเป็นผู้ให้ความยินยอม
    *   **กรณีจำเป็นต้องได้รับการบำบัดรักษา (ภาวะอันตราย/ความจำเป็น):** พนักงานเจ้าหน้าที่มีอำนาจนำตัวบุคคลไปประเมินอาการเบื้องต้น
    *   **บทบาทพนักงานเจ้าหน้าที่:** แพทย์ พยาบาล นักจิตวิทยา นักสังคมสงเคราะห์ และนักวิชาการสาธารณสุขในสังกัดต่างๆ สามารถเป็นพนักงานเจ้าหน้าที่ภายใต้ พ.ร.บ. นี้ได้ และมีอำนาจในการสอบถามข้อมูลเพื่อประกอบการพิจารณา
*   **ระเบียบกระทรวงสาธารณสุข ว่าด้วยการรักษาจรรยาบรรณแห่งวิชาชีพของผู้ประกอบโรคศิลปะ พ.ศ. 2549/2559:** เป็นกฎระเบียบที่เกี่ยวข้องกับการให้บริการทางสุขภาพจิต
*   **ข้อบังคับแพทยสภา ว่าด้วยการรักษาจริยธรรมแห่งวิชาชีพเวชกรรม พ.ศ. 2549:** กรณีที่แอปพลิเคชันมีจิตแพทย์ให้บริการ ต้องปฏิบัติตามข้อบังคับนี้

**6. ข้อควรพิจารณาทางเทคโนโลยีและระบบ (Technology and System Considerations):**
*   **ความปลอดภัยของข้อมูล:** ระบบต้องมีมาตรการป้องกันและรักษาข้อมูลที่ได้รับมาหรือมีเก็บไว้อย่างปลอดภัยและเป็นความลับ ไม่ว่าจะภายใต้รูปแบบการบันทึก การใช้เครื่องมือทางเทคโนโลยี หรือวิธีการอื่น ควรใช้การลงรหัสหรือเทคนิคอื่นเพื่อหลีกเลี่ยงการบ่งชี้ถึงตัวบุคคลและข้อมูลส่วนตัวของผู้รับบริการ ข้อมูลที่ส่งผ่านสื่ออิเล็กทรอนิกส์ต้องถูกปกปิดเป็นความลับโดยใช้ระบบเข้ารหัสที่เหมาะสม
*   **การเข้าถึงและการร้องเรียน:** แอปพลิเคชันควรแสดงช่องทางการเข้าถึงเว็บไซต์ของสมาคมจิตวิทยาการปรึกษาแห่งประเทศไทย (หรือองค์กรวิชาชีพที่นักจิตวิทยาสังกัด) เพื่อให้ผู้ใช้บริการมีข้อมูลสำหรับร้องเรียน และต้องตรวจสอบช่องทางให้สามารถใช้งานได้สะดวกและเป็นปัจจุบัน
*   **ความเป็นส่วนตัวในสื่อออนไลน์:** แพลตฟอร์มต้องกำหนดแนวทางที่ชัดเจนให้นักจิตวิทยาแยกหน้าเว็บเพจและโปรไฟล์ที่แสดงสถานะทางวิชาชีพ กับสถานะส่วนบุคคลออกจากกันในการใช้สื่อสังคมออนไลน์
*   **การจัดการกรณีฉุกเฉินทางเทคโนโลยี:** แจ้งผู้ใช้บริการถึงความขัดข้องหรือความผิดพลาดทางเทคโนโลยีที่อาจเกิดขึ้น และการให้บริการทดแทนด้วยวิธีอื่น รวมถึงแนวปฏิบัติกรณีเกิดเหตุฉุกเฉินที่ทำให้นักจิตวิทยาไม่สามารถให้บริการได้

**7. กลไกการจัดการข้อร้องเรียนและการทำผิดจรรยาบรรณ (Complaint Handling Mechanism):**
*   **การแจ้งเตือนและการจัดการเบื้องต้น:** เมื่อนักจิตวิทยาพบเห็นหรือเชื่อว่ามีการกระทำผิดจรรยาบรรณโดยนักจิตวิทยาอื่น ควรพยายามจัดการปัญหาโดยการแจ้งเตือนนักจิตวิทยาผู้กระทำผิด หากทำได้เหมาะสมและไม่ละเมิดสิทธิส่วนบุคคลหรือความลับ
*   **การรายงานการทำผิดจรรยาบรรณ:** หากการกระทำผิดจรรยาบรรณก่อให้เกิดอันตรายหรือผลเสียต่อผู้ใช้บริการและไม่สามารถจัดการเบื้องต้นได้ นักจิตวิทยาต้องดำเนินการขั้นต่อไปอย่างเหมาะสม ซึ่งอาจหมายถึงการส่งเรื่องไปยังกรรมการวิชาชีพหรือสถาบันที่เกี่ยวข้อง
*   **ความร่วมมือ:** สมาชิกของ APA (รวมถึงนักจิตวิทยาที่ให้บริการ) ต้องปฏิบัติตามหลักจรรยาบรรณและให้ความร่วมมือในการสอบสวน การดำเนินการ และการสรุปผลในกรณีที่เกี่ยวข้องกับปัญหาด้านจรรยาบรรณ
*   **การร้องเรียนที่ไม่เหมาะสม:** นักจิตวิทยาต้องไม่ฟ้องร้องหรือสนับสนุนการฟ้องร้องที่ไม่มีมูลชัดเจน และไม่เพิกเฉยต่อข้อกล่าวหาที่พิสูจน์ได้ว่าผิดจริง
*   **ความขัดแย้งในองค์กร:** หากความต้องการขององค์กรที่นักจิตวิทยาสังกัดอยู่ขัดแย้งกับหลักจรรยาบรรณ นักจิตวิทยาต้องแจ้งให้ผู้บริหารทราบถึงความรับผิดชอบในการรักษาจรรยาบรรณ และจัดการความขัดแย้งในแนวทางที่สอดคล้องกับหลักจรรยาบรรณ
*   **การขาดความรู้ไม่เป็นข้ออ้าง:** ความไม่รู้หรือความเข้าใจผิดต่อหลักจรรยาบรรณไม่สามารถนำมาเป็นข้ออ้างหรือข้อแก้ตัวต่อข้อหาการกระทำที่มิชอบด้วยจรรยาบรรณได้

---`;

            const payload = { contents: [{ role: "model", parts: [{ text: systemPrompt }] }, ...chatHistory] };
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API request failed: ${response.status}`);
                const result = await response.json();
                removeThinkingIndicator();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const aiResponse = result.candidates[0].content.parts[0].text;
                    addMessage('ai', aiResponse);
                    chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                } else { addMessage('ai', 'ขออภัยครับ มีข้อผิดพลาดบางอย่าง ลองใหม่อีกครั้งนะครับ'); }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                removeThinkingIndicator();
                addMessage('ai', 'ขออภัยครับ ระบบขัดข้องชั่วคราว กรุณาลองใหม่อีกครั้งในภายหลัง');
            }
        }

        function handlePrintChat() {
            const printableContent = document.getElementById('printable-content');
            let chatHTML = `<h1 class="text-2xl font-bold font-mitr mb-4">บทสนทนากับทราย</h1><div class="space-y-4">`;
            chatHistory.forEach(msg => {
                if(msg.role === 'user' || msg.role === 'model') {
                    const sender = msg.role === 'user' ? 'ผู้ใช้งาน' : 'ทราย';
                    const bubbleClass = msg.role === 'user' ? 'bg-sky-100' : 'bg-slate-100';
                    chatHTML += `<div class="p-4 rounded-lg ${bubbleClass}"><strong>${sender}:</strong> <p class="whitespace-pre-wrap">${msg.parts[0].text}</p></div>`;
                }
            });
            chatHTML += '</div>';
            printableContent.innerHTML = chatHTML;
            window.print();
        }

        function renderAssessmentList() {
            const container = assessmentListView.querySelector('.space-y-4');
            container.innerHTML = `
                <div class="group flex flex-col sm:flex-row items-center p-5 border border-slate-200 rounded-2xl hover:shadow-lg hover:border-sky-300 transition-all duration-300">
                    <div class="flex-grow text-center sm:text-left"><h3 class="font-bold text-lg font-mitr text-slate-800">แบบประเมินความเครียด (ST-5)</h3><p class="text-sm text-slate-500">วัดระดับความเครียดในช่วง 2 สัปดาห์ที่ผ่านมา</p></div>
                    <div class="flex-shrink-0 mt-4 sm:mt-0 sm:ml-4"><button data-id="st5" class="start-btn w-full sm:w-auto bg-sky-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-sky-600">เริ่มทำ</button></div>
                </div>
                <div class="group flex flex-col sm:flex-row items-center p-5 border border-slate-200 rounded-2xl hover:shadow-lg hover:border-rose-300 transition-all duration-300">
                    <div class="flex-grow text-center sm:text-left"><h3 class="font-bold text-lg font-mitr text-slate-800">8Q แบบประเมินการฆ่าตัวตาย</h3><p class="text-sm text-slate-500">ประเมินความคิดและความเสี่ยงในการฆ่าตัวตาย</p></div>
                    <div class="flex-shrink-0 mt-4 sm:mt-0 sm:ml-4"><button data-id="q8" class="start-btn w-full sm:w-auto bg-rose-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-rose-600">เริ่มทำ</button></div>
                </div>
                <div class="group flex flex-col sm:flex-row items-center p-5 border border-slate-200 rounded-2xl hover:shadow-lg hover:border-teal-300 transition-all duration-300">
                    <div class="flex-grow text-center sm:text-left"><h3 class="font-bold text-lg font-mitr text-slate-800">PHQ-A แบบประเมินซึมเศร้า</h3><p class="text-sm text-slate-500">คัดกรองอาการซึมเศร้าในวัยรุ่น</p></div>
                    <div class="flex-shrink-0 mt-4 sm:mt-0 sm:ml-4"><button data-id="phqa" class="start-btn w-full sm:w-auto bg-teal-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-teal-600">เริ่มทำ</button></div>
                </div>`;

            assessmentListView.querySelectorAll('.start-btn').forEach(btn => {
                btn.addEventListener('click', (e) => startAssessment(e.target.dataset.id));
            });
        }

        // --- INITIALIZATION & EVENT LISTENERS ---
        function initialize() {
            createPolicyModal();
            createEmergencyModal();

            switchView(landingView);

            // Landing View Logic
            document.getElementById('goto-chat-btn').addEventListener('click', () => {
                chatHistory = [];
                const chatMessages = chatView.querySelector('#chat-messages');
                chatMessages.innerHTML = '';
                addMessage('ai', `สวัสดีครับ มีอะไรให้พี่ทรายช่วยไหมครับ? เล่าให้พี่ฟังได้นะ`);
                switchView(chatView);
            });
            document.getElementById('goto-assessments-btn').addEventListener('click', () => {
                renderAssessmentList();
                switchView(assessmentListView);
            });
            document.querySelectorAll('.back-to-landing-btn').forEach(btn => btn.addEventListener('click', () => switchView(landingView)));

            // Policy Modal Logic
            const showPolicy = () => { policyModal.classList.remove('hidden'); document.getElementById('disabled-overlay').classList.remove('hidden'); };
            const hidePolicy = () => { policyModal.classList.add('hidden'); document.getElementById('disabled-overlay').classList.add('hidden'); };
            document.getElementById('show-policy-btn').addEventListener('click', showPolicy);
            policyModal.querySelector('#close-policy-btn').addEventListener('click', hidePolicy);
            policyModal.querySelector('#accept-policy-btn').addEventListener('click', hidePolicy);

            // Cookie Banner
            cookieBanner.innerHTML = `<p class="text-sm mb-4 sm:mb-0">เว็บไซต์นี้ใช้คุกกี้เพื่อเพิ่มประสบการณ์การใช้งานที่ดีขึ้น การเข้าใช้งานต่อถือว่าท่านยอมรับ<a href="#" id="open-policy-from-cookie" class="underline hover:text-sky-300 ml-1">นโยบายความเป็นส่วนตัว</a>ของเรา</p>
            <button id="accept-cookies-btn" class="bg-sky-500 text-white font-bold py-2 px-6 rounded-xl hover:bg-sky-600 transition-colors">ยอมรับ</button>`;
            cookieBanner.querySelector('#open-policy-from-cookie').addEventListener('click', (e) => { e.preventDefault(); showPolicy(); });
            if (!document.cookie.includes('cookie_consent=true')) cookieBanner.classList.remove('hidden');
            cookieBanner.querySelector('#accept-cookies-btn').addEventListener('click', () => {
                document.cookie = "cookie_consent=true; max-age=31536000; path=/";
                cookieBanner.style.opacity = '0';
                setTimeout(() => cookieBanner.classList.add('hidden'), 500);
            });

            // Emergency Modal
            document.getElementById('emergency-btn').addEventListener('click', () => emergencyModal.classList.remove('hidden'));
            emergencyModal.querySelector('#hide-emergency-btn').addEventListener('click', () => emergencyModal.classList.add('hidden'));

            // Chat
            chatView.querySelector('#chat-send-btn').addEventListener('click', handleSendMessage);
            chatView.querySelector('#chat-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendMessage(); });
            chatView.querySelector('#print-chat-btn').addEventListener('click', handlePrintChat);
        }

        initialize();
    });
    </script>
</body>
</html>
